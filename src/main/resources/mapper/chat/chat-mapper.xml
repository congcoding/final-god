<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="chat">
	<select id="selectChatRoomList" resultMap="chatRoom">
		select * from chatroom where sellerid=#{sellerId} or sellerid2=#{sellerId}
	</select>
	<select id="selectChatLog" resultMap="chatlogmap">
		select *
		from(select rownum as rnum, v.* from(select * from chat c left join chatroom c1 on c.chatroomno= c1.chatroomno where c.chatroomno = #{chatRoomNo} order by sendtime desc) v)v
		where rnum = 1
	</select>
	
	<select id="selectChattingLogs" resultMap="chat">
		select * from chat c left join chatroom c1 on c.chatroomno= c1.chatroomno where c.chatroomno = #{chatRoomNo} order by sendtime
	</select>
	<update id="updateReadFlag">
		update chat set readflag = 'Y' where chatroomno = #{chatRoomNo}
	</update>
	<insert id="insertChatLog">
		insert into chat values(seq_chatno.nextval,#{chatRoomNo},#{chatContent},default,#{sendMember},default)
	</insert>
	<!-- rnum이 포함되어있는 resultMap -->
	<resultMap type="map" id="chatlogmap">
		<result column="rnum" property="rnum" javaType="string"/>
		<result column="chatno" property="chatno" javaType="string"/>
		<result column="chatroomno" property="chatroomno" javaType="string"/>
		<result column="sendtime" property="sendtime" javaType="string"/>
		<result column="chatroomno_1" property="chatroomno1" javaType="string"/>
	</resultMap>
	<!-- rnum이 포함되어있지 않는 resultMap -->
	<resultMap type="map" id="chat">
		<result column="chatroomno_1" property="chatroomno1" javaType="string"/>
		<result column="sendtime" property="sendTime" javaType="string"/>
		<result column="chatno" property="chatNo" javaType="string"/>
		<result column="chatroomno" property="chatRoomNo" javaType="string"/>
	</resultMap>
	<resultMap type="chatRoom" id="chatRoom"></resultMap>
	
</mapper>
