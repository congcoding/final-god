<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="seller">

	<resultMap type="seller" id="sellerMap">
      <result column="hobby" property="hobby" typeHandler="strArrTypeHandler"/>
    </resultMap>
	<select id="selectOneSeller" resultType="seller" resultMap="sellerMap">
      select * from seller where sellerid= #{sellerId}
    </select>
    
    <insert id="insertSeller" >
    	insert into seller values(#{sellerId} , #{sellerName} , #{email}, #{phone} , sysdate , default , default , #{password} )
    </insert>
    
	<update id="updatePwd">
		update seller set password = #{password} where sellerid = #{sellerId}
	</update>
	
	<update id="updateSeller">
		update seller set email = #{email} , phone = #{phone}  where sellerid = #{sellerId}
	</update>
	
	<insert id="insertOrderInfo">
		insert into orderinfo(orderNo,memberid,storeno,totalPrice,cancelFlag,deliveryFlag,originalPrice,priceWay,receiveFlag,request,paymentId) values (SEQ_ORDERINFO.nextval,#{memberId},#{storeNo}, #{totalPrice},'N','N',#{orginalPrice},#{priceWay},'N',#{request},#{paymentId})
	</insert>
		
	<insert id="insertOrderMenu">
	   <selectKey resultType="_int" keyProperty="orderNo" order="BEFORE">
	   		select SEQ_ORDERINFO.currval from dual
	   </selectKey>
		insert into orderMenu(orderno,ordermenuno,menucode,storeno,amount) values (#{orderNo},SEQ_ORDERMENU.nextval,#{menuCode},#{storeNo},#{amount})		
	</insert>

	<!-- 종합 보기에서 저번주의 판매량을 가지고 오는 쿼리문 -->
	<select id="totalSaleVolumeofWeek" resultMap="totalOf">
		select to_char(ordertime,'dy')as orderday,sum(O.totalprice)as totalprice,S1.storename ,sum(O.originalprice)as originalprice, S1.sellerid, O.storeno
		from orderinfo O left join storeinfo S1 on O.storeno = S1.storeno join seller S2 on S1.sellerid = S2.sellerid
		where S1.sellerid = #{sellerId} and O.cancelflag = 'N' and ((TRUNC(sysdate, 'iw')-7)- O.ordertime <![CDATA[<=]]> 0) and (TRUNC(sysdate, 'iw') - O.ordertime >= 0)
		group by to_char(ordertime,'dy'),  S1.storename, O.storeno,S1.sellerid
	</select>
	<select id="totalSaleVolumeofToday" resultMap="totalOf">
		select to_char(ordertime,'hh24')as orderday,sum(O.totalprice)as totalprice,S1.storename ,sum(O.originalprice)as originalprice, S1.sellerid, O.storeno
		from orderinfo O left join storeinfo S1 on O.storeno = S1.storeno join seller S2 on S1.sellerid = S2.sellerid
		where S1.sellerid = #{sellerId} and O.cancelflag = 'N' and (TRUNC(sysdate)- O.ordertime <![CDATA[<=]]> 0) and (TRUNC(sysdate)+1 - O.ordertime >= 0)
		group by to_char(ordertime,'hh24'), S1.storename, O.storeno,S1.sellerid
	</select>
	<select id="totalSaleVolumeofMonth" resultMap="totalOf">
		select to_char(ordertime,'MM/dd')as orderday,sum(O.totalprice)as totalprice,S1.storename ,sum(O.originalprice)as originalprice, S1.sellerid, O.storeno
		from orderinfo O left join storeinfo S1 on O.storeno = S1.storeno join seller S2 on S1.sellerid = S2.sellerid
		where S1.sellerid = #{sellerId} and O.cancelflag = 'N' and extract(month from sysdate)-extract(month from ordertime)=1 
		group by to_char(ordertime,'MM/dd'), S1.storename, O.storeno,S1.sellerid
	</select>
	<select id="totalSaleVolumeof3Month" resultMap="totalOf">
	select to_char(ordertime,'MM')as orderday,sum(O.totalprice)as totalprice,S1.storename ,sum(O.originalprice)as originalprice, S1.sellerid, O.storeno
	from orderinfo O left join storeinfo S1 on O.storeno = S1.storeno join seller S2 on S1.sellerid = S2.sellerid
	where S1.sellerid = #{sellerId} and O.cancelflag = 'N' and extract(month from sysdate)-extract(month from ordertime) >= 1 and  extract(month from sysdate)-extract(month from ordertime) <![CDATA[<=]]> 3
	group by to_char(ordertime,'MM'), S1.storename, O.storeno,S1.sellerid
	</select>
	<resultMap type="map" id="totalOf">
		<result column="originalprice" property="ORIGINALPRICE" javaType="string"/>
		<result column="totalprice" property="TOTALPRICE" javaType="string"/>
	</resultMap>
	
	<select id="sellerfindId" resultType="seller">
		select * from seller where email = #{email}
	</select>
</mapper>
