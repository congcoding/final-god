<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="storeInfo">
	<select id="selectStoreInfoList" resultMap="storeInfoMap">
	select A.*, 
		(select count(*) 
		from storeInfo 
		where categoryno = A.categoryno) categorycount 
	from storeInfo A 
	where categoryno = #{categoryno} 
	order by storegrade desc
	</select>
	<resultMap type="storeInfo" id="storeInfoMap"></resultMap>
	
	<select id="selectStoreInfoTotalContents" resultType="_int" >
		SELECT COUNT(*) FROM STOREINFO WHERE CATEGORYNO = #{categoryno}
	</select>
	
	<select id="getMyStore" resultType="storeInfo">
	select * from storeinfo where sellerId = #{sellerId}
	</select>
	
	<insert id="addStore">
		insert into storeinfo values(#{storeNo} , #{storeName}, #{storeTel} , #{storeAddress} , default , #{categoryNo} , #{storeIntro}, #{personalDay} , #{operatingHours} , default, default ,#{deliveryMinPrice} , #{sellerId})
	</insert>
	
	<insert id="insertAttachment">
		insert into sattachment(attachmentno , storeno , originalfilename, renamedfilename, uploaddate , downloadcount, status )
		values (seq_sAttachmentno.nextval , #{storeNo} , #{originalFileName} , #{renamedFileName}, default, 0 ,default  )
	</insert>

	<select id="myStoreMenu" resultType="menu">
		select m.menuname, m.menuprice
		from storeinfo s join menu m on s.storeNo = m.storeNo
		where s.sellerId = #{sellerId}
    </select>

   <select id="menuList"  resultType="menu">
   	select * from menu where storeno = #{storeNo}
   </select>
   
   <select id="storeInfoList"  resultType="storeInfo">
   	   select * from storeinfo where storeno = #{storeNo}
   </select>
	
   <select id="menuCount"  resultType="_int">
   	  select count(*) from menu where storeno = #{storeNo}
   </select>
 
   <select id="getAttachment" resultType="menuAttachment">
   	select * from menuAttachment where storeNo = #{storeNo}
   </select>  
   
   <select id="getthumbAttachment" resultType="menuAttachment">
       	select * from menuAttachment where storeNo = #{storeNo} and thumbFlag = 'Y'
   </select>
   
   <update id="oldThumbNail">
   		update menuAttachment set thumbFlag='N' where renamedfilename=#{nowThumb}
   </update>
   
   <update id="changeThmbNail">
   		update menuAttachment set thumbFlag='Y' where renamedfilename=#{newThumb}
   </update>
   
   <update id="updateStoreInfo">
   	update storeInfo set storetel=#{storeTel},storeaddress = #{storeAddress}, operatinghours=#{operatingHours},personalday=#{personalday} where storeno=#{storeNo}
   </update>
   
   <select id="selectListStorInfo" resultType="storeInfo">
   		select * from storeinfo where sellerid = #{sellerId}
   </select>

	<select id="selectOnebyStoreNo" resultType="storeInfo">
		select * from storeinfo where storeno = #{storeNo}
	</select>
	
	<select id="selectAttchMentLsit" resultType="SAttachment">
		select * from sattachment where storeno = #{storeNo}
	</select>
	
	<update id="deleteFile1">
		update sattachment set status = 'Y' where originalfilename = #{filename}
	</update>
</mapper>
